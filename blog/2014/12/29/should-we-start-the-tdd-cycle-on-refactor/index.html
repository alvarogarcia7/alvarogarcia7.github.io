
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Should We Start the TDD Cycle on Refactor? - The long way through Software Craftsmanship</title>
  <meta name="author" content="alvaro garcia">

  
  <meta name="description" content="In this lexical scope, TDD by example is referring to this book1, available on Amazon The TDD cycle Altough Kent Beck in his book Test-Driven &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://alvarogarcia7.github.io/blog/2014/12/29/should-we-start-the-tdd-cycle-on-refactor">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/atom.xml" rel="alternate" title="The long way through Software Craftsmanship" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-41008374-3', 'auto');
    ga('send', 'pageview');

  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">The long way through Software Craftsmanship</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:alvarogarcia7.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/talks">Talks / Events</a></li>
  <li><a href="/blog/categories">Categories</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Should We Start the TDD Cycle on Refactor?</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-29T20:30:01+01:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:30 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In this lexical scope, TDD by example is referring to this book<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>, available <a href="http://www.amazon.com/Test-Driven-Development-By-Example/dp/0321146530">on Amazon</a></p>

<h3>The TDD cycle</h3>

<p>Altough <a href="https://twitter.com/KentBeck">Kent Beck</a> in his book Test-Driven Development by example explains in &ldquo;Part I: the money example&rdquo;<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> that one should</p>

<blockquote><p>quickly add a test;</p>

<p>run all the tests and see the new one fail [&hellip;]</p>

<p><cite>Kent Beck </cite></p></blockquote>

<p>Implying that the TDD cycle starts with the red. Later on he explains that the cycle continues with green and refactor and back to red.</p>

<p>But I&rsquo;ve been hearing for a while that there&rsquo;re some useful refactors to be done before introducing new code. Rings in my head but the only example I have is Xavi Gost&rsquo;s &ldquo;La economía del refactoring<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>&rdquo;</p>

<h3>Refactoring</h3>

<p>Let&rsquo;s take a look at the definition of refactor (found <a href="http://www.refactoring.com/">here</a>):</p>

<blockquote><p>[Refactoring] is a disciplined technique for restructuring an existing body of code, altering its internal structure without changing its external behavior.</p>

<p> <cite>Martin Fowler</cite></p></blockquote>

<p>I&rsquo;ve found some info on <a href="http://stackoverflow.com/questions/1355101/test-code-refactor-when-should-we-start-a-refactoring">stackoverflow</a> about the subject. The currently <a href="http://stackoverflow.com/a/1355782">accepted answer</a> points out some interesting comments:</p>

<ul>
<li>Do not refactor on red. Always a good reminder</li>
<li>If you are refactoring for introducing a feature, how much refactor is enough? This is speculative development, possibly taking much time from needed development</li>
</ul>


<p>The last point is the one that interests me the most:</p>

<ul>
<li>Your refactoring might not be where you&rsquo;re going to introduce new production code<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup> (spatial caché)</li>
<li>You might end up introducing features after a few hours/days of refactoring, therefore losing focus on the refactor you did and why (local caché)</li>
<li>Given that I&rsquo;ve already &ldquo;cleaned up&rdquo; this, I could also go somewhere else (slippery slope). Heard from <a href="https://twitter.com/xav1uzz">Xavi Gost</a> at the CAS2014 at his talk <a href="http://cas2014.agile-spain.org/sessions/sesion-1h-la-economia-del-refactoring-una-vision-desde-la-gestion-economica-del-proyecto-xavier-gost/">La economía del refactoring</a></li>
</ul>


<blockquote><p>No está justificado hacer cambios fuera de la rebanada.</p></blockquote>

<p>Roughly translated to &ldquo;It&rsquo;s not justified to change outside the bread slice&rdquo;, as Xavi was referring to software as sliced bread instead of layers, vertical rather than horizontal</p>

<h3>Should you do it?</h3>

<ul>
<li>Doing it would be a good thing, as long as you know in advance what will be affected by the next feature.</li>
<li>It can allow for less refactoring at the end of the cycle. This is not about duplication but refactoring to patterns. There might be a gain in refactoring to a pattern before introducing another feature. An example might be adding a new strategy when it&rsquo;s currently coded as if-then-else</li>
<li>The last responsible moment might be before or after introducing the feature. You decide.</li>
<li>Work less as there&rsquo;s no need for adding new cases to old structures and then simplifying</li>
</ul>


<h3>Should you not do it?</h3>

<ul>
<li>Foreseeing the future is difficult, therefore you might end with unused development, as it is speculating</li>
<li>Related to the last point, you might end refactoring in the wrong places. There&rsquo;s no current business value to it.</li>
<li>Not useful on first round of a new feature, you can use a lambda transition to the red again. But then, this is not a general pattern, only applicable to a big percent of cases.</li>
</ul>


<h2>Conclusions</h2>

<p>Short answer: it mainly depends on your environment:</p>

<ul>
<li>You: experience, common sense (sadly) &mdash;another post coming&mdash;, benefit/time-wasted ratio</li>
<li>Your project: how tight are deadlines, how critical that code is, the team&rsquo;s pressure</li>
</ul>


<p>Long answer: Yes, as long as:
 1. You realize there is a fine line between fixing code and rewriting code (Egoless programming #4). Don&rsquo;t be a lone enforcer
 2. Strictly follow the boy scout rule but only around your campfire, not outside of it.
 1. You know your domain, pitfalls and team well
 1. You want to test this hypothesis and post an answer</p>

<h3>Sources</h3>

<ul>
<li><a href="http://cas2014.agile-spain.org/sessions/sesion-1h-la-economia-del-refactoring-una-vision-desde-la-gestion-economica-del-proyecto-xavier-gost/">La economía del refactoring</a>, <a href="https://twitter.com/xav1uzz">Xavi Gost</a></li>
<li><a href="http://www.amazon.com/Test-Driven-Development-By-Example/dp/0321146530">Test-Driven Development by example</a>, <a href="https://twitter.com/KentBeck">Kent Beck</a></li>
<li><a href="http://refactoring.com">Refactoring.com</a>, <a href="https://twitter.com/martinfowler">Martin Fowler</a></li>
</ul>

<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Test-Driven Development by example; Beck, K. (ISBN-13: 078-5342146530)<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>from the book, description of part I, before chapter I<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>That talk is not yet available (AFAIK), but there&rsquo;s a <a href="http://ocana.github.io/articles/Conferencia-Agile-Spain-2014-primer-dia/">post</a> about it (Spanish)<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>The &ldquo;pains&rdquo; you might feel before introducing new features might not be real<a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">alvaro garcia</span></span>

      




<time class='entry-date' datetime='2014-12-29T20:30:01+01:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:30 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cas2k14/'>cas2k14</a>, <a class='category' href='/blog/categories/hypothesis/'>hypothesis</a>, <a class='category' href='/blog/categories/new-idea/'>new-idea</a>, <a class='category' href='/blog/categories/refactoring/'>refactoring</a>, <a class='category' href='/blog/categories/tdd/'>tdd</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://alvarogarcia7.github.io/blog/2014/12/29/should-we-start-the-tdd-cycle-on-refactor/" data-via="" data-counturl="http://alvarogarcia7.github.io/blog/2014/12/29/should-we-start-the-tdd-cycle-on-refactor/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/12/18/global-day-of-code-retreat/" title="Previous Post: Global Day of Code Retreat 2014">&laquo; Global Day of Code Retreat 2014</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/01/06/talk-is-tdd-dead-of-course-not-by-emily-bache/" title="Next Post: Talk: 'Is TDD Dead? Of course not! But what´s all the fuzz about then?' by Emily Bache">Talk: &#8216;Is TDD Dead? Of course not! But what´s all the fuzz about then?&#8217; by Emily Bache &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/25/whose-fault-is-this/">Whose Fault Is This?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/25/how-i-read-apprenticeship-patterns/">How I Read Apprenticeship Patterns</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/25/demand-for-tdd-and-refactor/">Demand for TDD and Refactor</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/25/talks-i-have-attended-at-the-craft-conf-2015/">Talks I Have Attended at the Craft Conf 2015</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/21/what-legacy-code-is-about/">What Legacy Code Is About</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/alvarogarcia7">@alvarogarcia7</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'alvarogarcia7',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - alvaro garcia -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'thelongwaythroughsoftwarecraftsmanship';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://alvarogarcia7.github.io/blog/2014/12/29/should-we-start-the-tdd-cycle-on-refactor/';
        var disqus_url = 'http://alvarogarcia7.github.io/blog/2014/12/29/should-we-start-the-tdd-cycle-on-refactor/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
